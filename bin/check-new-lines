#!/bin/sh

FILES=$(git status --porcelain)

for line in $FILES; do
  if [[ "$line" != *.json && -e "$line" ]]
  then
    if [[ -s "$line" && -z "$(tail -c 1 "$line")" ]]
    then
        continue
    else
        exec 1>&2
        echo "No newline at end of $line!"
        exit 1
    fi
  fi
done

if [[ $(jq input.json) != $(cat input.json)]]
then
  exec 1&>2
  echo "input.json is incorrectly formatted"
  exit 1
fi