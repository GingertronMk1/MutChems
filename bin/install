#!/bin/sh

echo "Stack installing program"
stack install

if [ ! -f src/Data/Other.hs ]; then
  echo "Copying Other.hs.dist"
  cp src/Data/Other.hs.dist src/Data/Other.hs
else
  echo "Skipping copy of Other data"
fi

INSTALL_REQUIREMENTS=0

while getopts r: flag
do
  case "${flag}" in
    r) INSTALL_REQUIREMENTS=${OPTARG}
  esac
done

if [ $INSTALL_REQUIREMENTS -gt 0 ]; then
  echo "Going through requirements"

  REQUIREMENTS=$(cat requirements.txt)

  for line in $REQUIREMENTS; do
    echo "Stack installing $line"
    stack install $line
  done
else
  echo "Skipping requirements"
fi

echo "Done"

echo "Copying pre-commit hook"

ln -s $(pwd)/bin/check-new-lines $(pwd)/.git/hooks/pre-commit

echo "Pre-commit hook copied!"
